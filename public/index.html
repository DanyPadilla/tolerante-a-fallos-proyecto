<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adivinanza</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        h1 {
            margin-top: 50px;
        }
        #resultado {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>¡Adivina el número!</h1>
    <form id="formulario">
        <label for="conjetura">Ingresa tu conjetura (entre 1 y 100):</label><br>
        <input type="number" id="conjetura" name="conjetura" min="1" max="100" required><br>
        <button type="submit" id="botonAdivinar">Adivinar</button>
    </form>
    <button id="nuevoNumero">Generar nuevo número</button>
    <div id="resultado"></div>
    <div id="intentos"></div>

    <script>
        const formulario = document.getElementById('formulario');
        const botonAdivinar = document.getElementById('botonAdivinar');
        const resultado = document.getElementById('resultado');
        const nuevoNumeroButton = document.getElementById('nuevoNumero');
        const intentosDiv = document.getElementById('intentos');

        let intentosRestantes = 5;

        // Función para actualizar el mensaje de intentos
        const actualizarIntentos = () => {
            intentosDiv.innerText = `Intentos restantes: ${intentosRestantes}`;
        };

        const obtenerNuevoNumero = async () => {
            intentosRestantes = 5;
            actualizarIntentos();
            formulario.reset(); // Reiniciar el formulario
            botonAdivinar.disabled = false; // Habilitar el botón de adivinar
        
            try {
                const response = await fetch('http://localhost:3001/generar-numero-aleatorio');
                if (response.ok) {
                    const data = await response.json();
                    console.log(data.numero);
                    if (data.numero) {
                        resultado.innerText = `Se generó el número ${data.numero}`;

                    } else {
                        resultado.innerText = 'Error al generar el nuevo número.';
                    }
                } else {
                    resultado.innerText = 'Error en la respuesta del servidor.';
                }
            } catch (error) {
                console.error('Error al obtener el número aleatorio:', error);
                resultado.innerText = 'Error al conectar con el servidor.';
            }
        };
        
        

        // Envía una solicitud GET al iniciar la página para obtener el primer número
        obtenerNuevoNumero();

        formulario.addEventListener('submit', async (event) => {
            event.preventDefault();
            const conjetura = parseInt(document.getElementById('conjetura').value);
            const response = await fetch('http://localhost:3002/iniciar-adivinanza', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ conjetura })
            });
            const data = await response.json();
            if (data.mensaje) {
                resultado.innerText = data.mensaje;
            } else {
                resultado.innerText = 'Error al procesar la conjetura.';
            }
            if (data.mensaje.includes('Incorrecto')) {
                intentosRestantes--;
                actualizarIntentos();
                if (intentosRestantes === 0) {
                    botonAdivinar.disabled = true; // Deshabilitar el botón de adivinar
                    resultado.innerText += ' Se han agotado tus intentos.';
                }
            }
        });

        nuevoNumeroButton.addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:3003/reiniciar-juego', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({}) // Si necesitas enviar datos en el cuerpo de la solicitud, ponlos aquí
                });
                // Hacer una solicitud GET al nuevo endpoint
                const data = await response.json();
                if (data.nuevoNumero) {
                    // Actualizar la interfaz de usuario con el nuevo número generado
                    document.getElementById('resultado').innerText = data.mensaje;
                    document.getElementById('conjetura').value = ''; // Limpiar el campo de conjetura
                } else {
                    console.error('Error al reiniciar el juego:', data.error);
                }
            } catch (error) {
                console.error('Error al reiniciar el juego:', error);
            }
        });
        

    </script>
</body>
</html>
